{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="header-with-filter">
        <h1><i class="fas fa-comments"></i> Latest Discussions</h1>
        <div class="filter-box">
            <h3><i class="fas fa-filter"></i> Filter</h3>
            <form method="get" action="/" class="filter-form">
                <input type="text" name="university" class="filter-input" 
                       placeholder="University" value="{{ request.args.get('university', '') }}">
                <input type="text" name="department" class="filter-input" 
                       placeholder="Department" value="{{ request.args.get('department', '') }}">
                <input type="text" name="city_country" class="filter-input" 
                       placeholder="City or country" value="{{ request.args.get('city_country', '') }}">
                <button type="submit" class="filter-btn">
                    <i class="fas fa-search"></i> Apply
                </button>
                {% if request.args.get('university') or request.args.get('department') or request.args.get('city_country') %}
                <a href="/" class="filter-clear">
                    <i class="fas fa-times"></i> Clear
                </a>
                {% endif %}
            </form>
        </div>
    </div>

    <!-- Comments -->
    <div class="comments-section">
        {% for comment in comments %}
            <div class="comment-card" id="comment-{{ comment.id }}">
                <div class="comment-header">
                    <div class="user-info">
                        <a href="{{ url_for('profile', user_id=comment.user.id) }}" class="user-name">
                            <i class="fas fa-user-circle"></i> {{ comment.user.username }}
                        </a>
                        <div class="user-details">
                            {{ comment.user.university }} - {{ comment.user.department }}
                            <span class="location">({{ comment.user.city }}, {{ comment.user.country }})</span>
                        </div>
                    </div>
                    <div class="comment-date">
                        {{ comment.timestamp.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                </div>
                
                <div class="comment-content">
                    <p>{{ comment.content }}</p>
                </div>
                
                <div class="comment-actions">
                    <button id="like-btn-{{ comment.id }}" class="like-btn" data-comment-id="{{ comment.id }}">
                        <i class="far fa-thumbs-up"></i>
                        <span id="like-count-{{ comment.id }}">{{ comment.likes|length }}</span>
                    </button>
                    
                    <a href="{{ url_for('comment_detail', comment_id=comment.id) }}" class="reply-btn">
                        <i class="fas fa-reply"></i> Reply
                    </a>
                    
                    {% if user and user.id == comment.user_id %}
                    <button class="delete-btn" onclick="deleteComment({{ comment.id }})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-comments"></i>
                <h3>No comments yet</h3>
                <p>Be the first to start a discussion!</p>
            </div>
        {% endfor %}
    </div>

    <!-- Add Comment Form -->
    {% if user %}
    <div class="add-comment-section">
        <h2><i class="fas fa-edit"></i> Add Comment</h2>
        <form id="comment-form" method="POST" action="{{ url_for('add_comment') }}">
            <div class="form-group">
                <textarea name="content" class="form-textarea" 
                          placeholder="Share your thoughts..." required rows="4"></textarea>
            </div>
            <button type="submit" class="form-btn">
                <i class="fas fa-paper-plane"></i> Post
            </button>
        </form>
    </div>
    {% else %}
    <div class="login-prompt">
        <div class="login-prompt-content">
            <i class="fas fa-lock"></i>
            <h3>Login to join the discussion</h3>
            <a href="{{ url_for('login') }}" class="form-btn">Login</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .header-with-filter {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
        gap: 2rem;
    }
    
    .header-with-filter h1 {
        color: var(--primary-color);
        margin: 0;
        flex: 1;
    }
    
    .filter-box {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        width: 300px;
    }
    
    .filter-box h3 {
        margin: 0 0 1rem 0;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .filter-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    @media (max-width: 900px) {
        .header-with-filter {
            flex-direction: column;
        }
        
        .filter-box {
            width: 100%;
        }
    }
</style>
{% endblock %}